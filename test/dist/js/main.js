'use strict';var desktop,svg,simulation,width,height,forceCollide,forceCenter,forceManyBody,forceX,forceY,nodes,colours,sizes,svg_circles,svg_images,svg_labels,HOVER_RAD_GROWTH=20,SPAWN_RANGE=2e3,NODE_MARGIN=2,LABEL_Y_OFFSET=-10,IMAGE_BORDER=2,IMAGE_BORDER_FOCUS=5,MOBILE_WIDTH=766,modal_item_index,redraw=function(){d3.selectAll('svg > *').remove(),simulation=d3.forceSimulation(),width=desktop.clientWidth,height=desktop.clientHeight,console.log('Redrawing: '+width+' x '+height),svg.attr('width',width).attr('height',height),forceCollide=d3.forceCollide().radius(function(c){return c.r+NODE_MARGIN}).iterations(50).strength(1),forceCenter=d3.forceCenter([width/2,height/2]).x(width/2).y(height/2),forceManyBody=d3.forceManyBody().strength(1e3),forceX=d3.forceX(width/2).strength(0.1),forceY=d3.forceY(height/2).strength(0.1),simulation.nodes(nodes).force('manyBody',forceManyBody).force('center',forceCenter).force('x',forceX).force('y',forceY).force('collide',forceCollide).velocityDecay(0.6).on('tick',ticked);var b=svg.selectAll('.node').data(nodes).enter().append('g').attr('class','node');b.append('circle').attr('fill',function(c){return colours[c.category]}),b.append('image').attr('xlink:href',function(c){return c.img}),b.append('text').text(function(c){return c.name}).attr('text-anchor','middle').attr('class','nodetext'),svg_circles=b.selectAll('circle'),svg_labels=b.selectAll('text'),svg_images=b.selectAll('image'),b.on('mouseenter',function(c){c.r=sizes[c.category]+HOVER_RAD_GROWTH,refreshSimulationNodes()}).on('mouseleave',function(c){c.r=sizes[c.category],refreshSimulationNodes()}).on('click',function(){console.log('yellow')})},ticked=function(){svg_circles.attr('r',function(b){return b.r}).attr('cx',function(b){return b.x}).attr('cy',function(b){return b.y}),svg_images.attr('x',function(b){return b.x-b.r+IMAGE_BORDER}).attr('y',function(b){return b.y-b.r+IMAGE_BORDER}).attr('width',function(b){return 2*(b.r-IMAGE_BORDER)}).attr('height',function(b){return 2*(b.r-IMAGE_BORDER)}),svg_labels.attr('dx',function(b){return b.x}).attr('dy',function(b){return b.y})},refreshSimulationNodes=function(){simulation.stop(),simulation.nodes(nodes),simulation.alpha(1),simulation.restart()};d3.json('dist/data/nodedata.json',function(a,b){if(a)throw a;nodes=b.nodes,colours=b.colours,sizes=b.sizes,desktop=document.getElementById('desktop'),svg=d3.select(desktop).append('svg'),width=desktop.clientWidth,height=desktop.clientHeight,nodes.map(function(c){return c.r=sizes[c.category],c.x=Math.random()*SPAWN_RANGE-SPAWN_RANGE/2+width/2,c.y=Math.random()*SPAWN_RANGE-SPAWN_RANGE/2+height/2,c}),redraw(),window.addEventListener('resize',function(){desktop.clientWidth>MOBILE_WIDTH?redraw():simulation.stop()})});