let desktop,svg,simulation,width,height,forceCollide,forceCenter,forceManyBody,forceX,forceY,nodes,colours,sizes,svg_circles,svg_images,svg_labels;const HOVER_RAD_GROWTH=20,SPAWN_RANGE=2e3,NODE_MARGIN=2,LABEL_Y_OFFSET=-10,IMAGE_BORDER=2,IMAGE_BORDER_FOCUS=5,MOBILE_WIDTH=766;let modal_item_index;const redraw=function(){d3.selectAll('svg > *').remove(),simulation=d3.forceSimulation(),width=desktop.clientWidth,height=desktop.clientHeight,console.log('Redrawing: '+width+' x '+height),svg.attr('width',width).attr('height',height),forceCollide=d3.forceCollide().radius(b=>b.r+NODE_MARGIN).iterations(50).strength(1),forceCenter=d3.forceCenter([width/2,height/2]).x(width/2).y(height/2),forceManyBody=d3.forceManyBody().strength(1e3),forceX=d3.forceX(width/2).strength(0.1),forceY=d3.forceY(height/2).strength(0.1),simulation.nodes(nodes).force('manyBody',forceManyBody).force('center',forceCenter).force('x',forceX).force('y',forceY).force('collide',forceCollide).velocityDecay(0.6).on('tick',ticked);let a=svg.selectAll('.node').data(nodes).enter().append('g').attr('class','node');a.append('circle').attr('fill',b=>colours[b.category]),a.append('image').attr('xlink:href',b=>b.img),a.append('text').text(b=>b.name).attr('text-anchor','middle').attr('class','nodetext'),svg_circles=a.selectAll('circle'),svg_labels=a.selectAll('text'),svg_images=a.selectAll('image'),a.on('mouseenter',b=>{b.r=sizes[b.category]+HOVER_RAD_GROWTH,refreshSimulationNodes()}).on('mouseleave',b=>{b.r=sizes[b.category],refreshSimulationNodes()}).on('click',()=>{console.log('yellow')})};let ticked=function(){svg_circles.attr('r',a=>a.r).attr('cx',a=>a.x).attr('cy',a=>a.y),svg_images.attr('x',a=>a.x-a.r+IMAGE_BORDER).attr('y',a=>a.y-a.r+IMAGE_BORDER).attr('width',a=>2*(a.r-IMAGE_BORDER)).attr('height',a=>2*(a.r-IMAGE_BORDER)),svg_labels.attr('dx',a=>a.x).attr('dy',a=>a.y)},refreshSimulationNodes=function(){simulation.stop(),simulation.nodes(nodes),simulation.alpha(1),simulation.restart()};d3.json('Data/nodedata.json',(a,b)=>{if(a)throw a;nodes=b.nodes,colours=b.colours,sizes=b.sizes,desktop=document.getElementById('desktop'),svg=d3.select(desktop).append('svg'),width=desktop.clientWidth,height=desktop.clientHeight,nodes.map(c=>{return c.r=sizes[c.category],c.x=Math.random()*SPAWN_RANGE-SPAWN_RANGE/2+width/2,c.y=Math.random()*SPAWN_RANGE-SPAWN_RANGE/2+height/2,c}),redraw(),window.addEventListener('resize',()=>{desktop.clientWidth>MOBILE_WIDTH?redraw():simulation.stop()})});